var Rt=Object.create;var ve=Object.defineProperty;var Ct=Object.getOwnPropertyDescriptor;var Pt=Object.getOwnPropertyNames;var Ft=Object.getPrototypeOf,St=Object.prototype.hasOwnProperty;var yt=(i,e)=>{for(var t in e)ve(i,t,{get:e[t],enumerable:!0})},rt=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Pt(e))!St.call(i,o)&&o!==t&&ve(i,o,{get:()=>e[o],enumerable:!(n=Ct(e,o))||n.enumerable});return i};var y=(i,e,t)=>(t=i!=null?Rt(Ft(i)):{},rt(e||!i||!i.__esModule?ve(t,"default",{value:i,enumerable:!0}):t,i)),Mt=i=>rt(ve({},"__esModule",{value:!0}),i);var b=(i,e,t)=>new Promise((n,o)=>{var s=a=>{try{r(t.next(a))}catch(c){o(c)}},l=a=>{try{r(t.throw(a))}catch(c){o(c)}},r=a=>a.done?n(a.value):Promise.resolve(a.value).then(s,l);r((t=t.apply(i,e)).next())});var At={};yt(At,{activate:()=>Wt});module.exports=Mt(At);var S=y(require("vscode"));var je=y(require("vscode"));var lt=y(require("vscode")),R=class{static Init(e){this.extension=e.extension}static getConfiguration(e){let n=this.extension.packageJSON.name;return lt.workspace.getConfiguration(n,e)}};var f=class{static init(){var n,o,s;let e=R.getConfiguration();f.globalToggleCommentPrefix=e.comments.toggleLineCommentPrefix,f.globalEnablePushPopMatching=e.enablePushPopMatching,f.globalEnableCodeLenses=!1,f.globalEnableHovering=!1,f.globalEnableCompletions=!1,f.globalEnableGotoDefinition=!1,f.globalEnableFindAllReferences=!1,f.globalEnableRenaming=!1,f.globalEnableOutlineView=!1;let t=(n=je.workspace.workspaceFolders)!=null?n:[];for(let l of t){let r=new f,a=l.uri.fsPath;r.wsFolderPath=a;let c=R.getConfiguration(l);r.labelsWithColons=!0,r.labelsWithoutColons=!0;let d=(((o=c.labels)==null?void 0:o.colon)||"").toLowerCase();d.startsWith("without ")?r.labelsWithColons=!1:d.startsWith("with ")&&(r.labelsWithoutColons=!1);let u=((s=c.labels)==null?void 0:s.excludes)||"";r.labelsExcludes=u.toLowerCase().split(";"),r.excludeFiles=c.excludeFiles,r.enableCodeLenses=c.enableCodeLenses,r.enableHovering=c.enableHovering,r.enableCompletions=c.enableCompletions,r.enableGotoDefinition=c.enableGotoDefinition,r.enableFindAllReferences=c.enableFindAllReferences,r.enableRenaming=c.enableRenaming,r.enableOutlineView=c.enableOutlineView,r.completionsRequiredLength=c.completionsRequiredLength||0,r.completionsRequiredLength<1&&(r.completionsRequiredLength=1),r.workspaceSymbolsRequiredLength=c.workspaceSymbolsRequiredLength,r.workspaceSymbolsRequiredLength<1&&(r.workspaceSymbolsRequiredLength=1),r.enableWorkspaceSymbols=c.enableWorkspaceSymbols,r.enableFolding=c.enableFolding,f.configs.set(a,r),f.globalEnableCodeLenses||(f.globalEnableCodeLenses=c.enableCodeLenses),f.globalEnableHovering||(f.globalEnableHovering=r.enableHovering),f.globalEnableCompletions||(f.globalEnableCompletions=r.enableCompletions),f.globalEnableGotoDefinition||(f.globalEnableGotoDefinition=r.enableGotoDefinition),f.globalEnableFindAllReferences||(f.globalEnableFindAllReferences=r.enableFindAllReferences),f.globalEnableRenaming||(f.globalEnableRenaming=r.enableRenaming),f.globalEnableOutlineView||(f.globalEnableOutlineView=r.enableOutlineView),f.globalEnableWorkspaceSymbols||(f.globalEnableWorkspaceSymbols=r.enableWorkspaceSymbols)}}static getConfigForDoc(e){if(!e)return;let t=je.workspace.getWorkspaceFolder(e.uri);if(t)return f.configs.get(t.uri.fsPath)}},x=f;x.configs=new Map;var pe=class extends RegExp{constructor(t,n){super(n);this.find=t}exec(t){return t.indexOf(this.find)<0?null:super.exec(t)}},k=class extends RegExp{constructor(t,n){super(n);this.simpleRegex=t}exec(t){return this.simpleRegex.exec(t)?super.exec(t):null}};var p=class{static regexLabelWithAndWithoutColon(){return/(^@?)([a-z_][\w.]*):?/i}static regexLabelWithColon(e){return e==="asm-list-file"?new pe(":",/(^[^#]*\s@?)([a-z_][\w.]*):/i):/(^@?)([a-z_][\w.]*):/i}static regexLabelWithoutColon(){return/^(@?)([a-z_][\w.]*)(?:\s|$)/i}static regexLabel(e,t){return t==="asm-list-file"?p.regexLabelWithColon(t):e.labelsWithColons&&e.labelsWithoutColons?p.regexLabelWithAndWithoutColon():e.labelsWithoutColons?p.regexLabelWithoutColon():p.regexLabelWithColon(t)}static regexInclude(){return new k(/INCLUDE/i,/\s*INCLUDE\s+"(.*)"/i)}static regexModuleStruct(){return new k(/(MODULE|STRUCT)/i,/^.*\s(MODULE|STRUCT)\s+([\w.]+)/i)}static regexEndModuleStruct(){return new k(/(ENDMODULE|ENDS)/i,/^.*\s(ENDMODULE|ENDS)\b/i)}static calcStartIndex(e){let t=e.index;for(let n=1;n<e.length;n++)if(e[n]){let o=e[n].length;t+=o}return t}static regexLabelColonForWord(e,t){return t=="asm-list-file"?new k(new RegExp(e,"i"),new RegExp("^(.*?\\s)([[a-zA-Z_\\.][\\w\\.]*)?\\b"+e+":")):new RegExp("^()([a-zA-Z_\\.][\\w\\.]*)?\\b"+e+":")}static regexLabelWithoutColonForWord(e){return new RegExp("^()([a-zA-Z_\\.][\\w\\.]*)?\\b"+e+"\\b(?![:\\.])")}static regexesLabelForWord(e,t,n){let o=[];if(t.labelsWithColons){let s=p.regexLabelColonForWord(e,n);o.push(s)}if(t.labelsWithoutColons&&n=="asm-collection"){let s=p.regexLabelWithoutColonForWord(e);o.push(s)}return o}static regexModuleForWord(e){return new k(/module/i,new RegExp("^(.*\\s(module|MODULE)\\s+)"+e+"\\b"))}static regexMacroForWord(e){return new k(/macro/i,new RegExp("^(.*\\s(macro|MACRO)\\s+)"+e+"\\b"))}static regexAnyReferenceForWord(e){return new pe(e,new RegExp("^([^#]*)\\b"+e+"\\b"))}static regexPrepareFuzzy(e){return e.replace(/(.)/g,"\\w*$1")}};var V=y(require("vscode"));var me,Ue,at,Le;function ct(i){Le=new Set([";","//"]),i&&Le.add(i);let e=Array.from(Le),t=`("|'|/\\*|`+e.join("|")+")";me=new RegExp(t,"g");let n="^(.*?)("+e.join("|")+")(.*)";Ue=new RegExp(n,"i");let o="("+e.join("|")+")";at=new RegExp(o,"i")}function ne(i){let e=!1,t=i.length;for(let n=0;n<t;n++){let o=i[n];if(e){let l=o.indexOf("*/");if(l>=0)o=" ".repeat(l+2)+o.substring(l+2),e=!1;else{i[n]="";continue}}me.lastIndex=0;let s;for(;s=me.exec(o);){let l=s.index,r=s[1];if(r==='"'||r==="'"){let a=o.indexOf(r,l+1);if(a>=0)o=o.substring(0,l)+" ".repeat(a-l+1)+o.substring(a+1),me.lastIndex=a+1;else{o=o.substring(0,l);break}}else if(r==="/*"){let a=o.indexOf("*/",l+2);if(a>=0)o=o.substring(0,l)+" ".repeat(a-l+2)+o.substring(a+2),me.lastIndex=a+2;else{o=o.substring(0,l),e=!0;break}}else if(Le.has(r)){o=o.substring(0,l);break}}i[n]=o}}function dt(i,e){if(i.length==0||e<0||e>=i.length)return[];let t=[],n=i[e];(at.test(n)||n.toLowerCase().indexOf("equ")>=0)&&t.unshift(n);let s=e-1;if(s>=0){let l=i[s],r=l.indexOf("*/");r<0&&(r=Number.MAX_SAFE_INTEGER);let a=Ue.exec(l),c=Number.MAX_SAFE_INTEGER;if(a&&(c=a[1].length),r!=c)if(c<r)for(t.unshift(a[3]),s--;s>=0;){let d=i[s],u=Ue.exec(d);if(!u)break;t.unshift(u[3]),s--}else{let d=l.substring(0,r);for(d=d.trimEnd(),d&&t.unshift(d),s--;s>=0;){let u=i[s],m=u.indexOf("/*");if(m>=0){let g=u.substring(m+2);g=g.trimEnd(),g&&t.unshift(g);break}t.unshift(u),s--}}}return t}function He(i){let e=p.regexModuleStruct(),t=p.regexEndModuleStruct(),n=[],o=i.length,s=[];for(let l=0;l<o;l++){let r=i[l],a=e.exec(r),c=t.exec(r);if(a)n.push(a[2]);else if(c)n.pop();else continue;let d=n.join(".");s.push({row:l,label:d})}return s}function ee(i,e,t=/[\w.]/){let n=i.length,o;for(o=e;o<n;o++){let a=i.charAt(o);if(!t.exec(a))break}let s;for(s=e-1;s>=0;s--){let a=i.charAt(s);if(!/[\w.]/.exec(a))break}s++;let l=i.substring(s,o),r=i.substring(0,s);return{label:l,preString:r}}function qe(i,e,t){let n;for(;t>=0;t--){let o=e[t];if(n=i.exec(o),n)return n[2]}}function It(i,e){return!i||i.length==0?e:i+"."+e}function ze(i,e,t,n,o=/[\w.]/){let s=e.lines,l=s[t],{label:r,preString:a}=ee(l,n,o);if(r.startsWith(".")){let m=qe(i,s,t);m&&(r=m+r)}let c;for(let m of e.modStructInfos){if(m.row>t)break;c=m.label}let d=It(c,r),u=a.length+r.length;return(a.length==0||l[u]==":")&&(r=d),{label:r,moduleLabel:d}}var ut=y(require("path")),gt=require("assert"),pt=y(require("vscode"));var fe=class{constructor(e,t){this.cacheTime=e,this.func=t,this.nextTime=Date.now()}getData(){let e=Date.now();return e>=this.nextTime&&(this.cachedData=this.func(),this.nextTime=e+this.cacheTime),this.cachedData}};var ce=class{static getGlobalIncludeForLanguageId(e){if(e=="asm-collection")return ce.asmCollectionCache.getData();if(e=="asm-list-file")return ce.asmFileListCache.getData();(0,gt.strict)(!1,'languageId = "'+e+'" unknown.')}static _getGlobalIncludeForLanguageId(e){let n=R.extension.packageJSON.contributes.languages,o=[];for(let a of n)if(a.id==e){o.push(...a.extensions.map(c=>c.substring(1)));break}let s=pt.workspace.getConfiguration("files.associations"),l=Object.entries(s);for(let[a,c]of l)if(typeof c=="string"){let d=ut.extname(a).substring(1);if(c==e)o.push(d);else{let u=o.indexOf(d);u>=0&&o.splice(u,1)}}return"**/*.{"+o.join(",")+"}"}},ae=ce;ae.asmCollectionCache=new fe(1e4,()=>ce._getGlobalIncludeForLanguageId("asm-collection")),ae.asmFileListCache=new fe(1e4,()=>ce._getGlobalIncludeForLanguageId("asm-list-file"));var Je=class extends V.Location{constructor(t,n,o){super(t,n);this.fileMatch=o;let{label:s}=ee(o.lineContents,o.start);this.symbol=s}};function Dt(i,e){let t=new Map;return i.forEach(o=>t.set(e(o),o)),Array.from(t.values())}function bt(i){return b(this,null,function*(){return new Promise((e,t)=>{let n=V.Uri.file(i);V.workspace.openTextDocument(n).then(o=>e(o),o=>t(o))})})}function mt(i){return b(this,null,function*(){try{let t=(yield bt(i)).getText().split(`
`);return ne(t),t}catch(e){return console.log(e),[]}})}function _(i,e,t,n){return b(this,null,function*(){let o=new Map;try{let l=ae.getGlobalIncludeForLanguageId(t),a=(yield V.workspace.findFiles(l,n)).filter(c=>c.fsPath.startsWith(e));for(let c of a){let d=c.fsPath,u=yield bt(d),m=Ke(u,i);for(let g of m)g.filePath=d;o.set(d,m)}}catch(l){console.log("Error: ",l)}let s=[];for(let[l,r]of o)for(let a of r){let c=a.line,d=a.start,u=a.end,m=new V.Position(c,d),g=new V.Position(c,u),w=new Je(V.Uri.file(l),new V.Range(m,g),a);s.push(w)}return s})}function X(i,e,t,n){return b(this,null,function*(){let o=[];for(let s of i){let l=yield _(s,e,t,n);o.push(...l)}return i.length>0&&(o=Dt(o,s=>{let l=s.fileMatch;return l.filePath+":"+l.line+":"+l.start})),o})}function Ke(i,e){let t=[],n=i.getText().split(`
`);ne(n);let o=n.length;for(let s=0;s<o;s++){let l=n[s];e.lastIndex=0;do{let r=e.exec(l);if(!r)break;let a=p.calcStartIndex(r),c=r.index+r[0].length;t.push({filePath:void 0,line:s,start:a,end:c,lineContents:l,match:r})}while(e.global)}return t}function ft(i){let e,t,n=i.indexOf(".");n<0?(e="",t=i):(e=i.substring(0,n+1),t=i.substring(n+1));let o=p.regexPrepareFuzzy(t)+"\\w*",s=e.replace(/(\.)/g,"\\.");return s+=o,new RegExp(s,"i")}function N(r,a,c,d){return b(this,arguments,function*(i,e,t,n,o=!0,s=!0,l=/[\w.]/){let u=yield mt(t),m=He(u),w=ze(i,{lines:u,modStructInfos:m},n.line,n.character,l),v,L;s||(v=ft(w.label),L=ft(w.moduleLabel));let h=[...e],j=new Map,P=h.length;for(;P--;){let D=h[P],I=D.uri.fsPath,F=D.range.start,C=j[I];if(!C){let O=yield mt(I),H=He(O);C={lines:O,modStructInfos:H},j[I]=C}if(o&&F.line===n.line&&I===t){h.splice(P,1);continue}let E=ze(i,C,F.line,F.character,l);if(D.label=E.label,D.moduleLabel=E.moduleLabel,s){if(E.label===w.label||E.moduleLabel===w.moduleLabel||E.moduleLabel===w.label||E.label===w.moduleLabel)continue}else if(v.exec(E.label)||L.exec(E.moduleLabel)||v.exec(E.moduleLabel)||L.exec(E.label))continue;h.splice(P,1)}return h})}function xt(i,e){let t=p.regexModuleStruct(),n=p.regexEndModuleStruct(),o=[];for(let l=0;l<e;l++){let r=i[l],a=t.exec(r);if(a){o.push(a[2]);continue}n.exec(r)&&o.pop()}return o.join(".")}var Ee=class{provideReferences(e,t,n,o){return b(this,null,function*(){let s=x.getConfigForDoc(e);if(!(s!=null&&s.enableFindAllReferences))return;let l=e.getWordRangeAtPosition(t);if(!l)return;let r=e.getText(l),a=p.regexAnyReferenceForWord(r),c=e.languageId,d=yield _(a,s.wsFolderPath,c,s.excludeFiles),u=p.regexLabel(s,c);return yield N(u,d,e.fileName,t,!1,!0,/\w/)})}};var Re=class{static regexStructForWord(e){return new k(/struct/i,new RegExp("^(.*?\\s+(struct|STRUCT)\\s+)"+e+"\\b"))}};var G=y(require("vscode"));var Ce=class{provideDefinition(e,t,n){return b(this,null,function*(){let o=x.getConfigForDoc(e);if(!o){yield G.window.showWarningMessage("Document is in no workspace folder.");return}if(!o.enableGotoDefinition){yield G.window.showWarningMessage("Goto definitions are disabled for this workspace folder.");return}let s=e.lineAt(t.line).text,l=p.regexInclude().exec(s);return l?this.getInclude(o,l[1]):this.search(o,e,t)})}getInclude(e,t){return b(this,null,function*(){let n=new G.RelativePattern(e.wsFolderPath,"**/"+t),o=yield G.workspace.findFiles(n,null),s=[],l=new G.Position(0,0),r=new G.Range(l,l);for(let a of o){let c=new G.Location(a,r);s.push(c)}return s})}search(e,t,n){return b(this,null,function*(){let o=t.getWordRangeAtPosition(n);if(!o)return;let s=t.getText(o);if(e.labelsExcludes.includes(s))return;let l=t.languageId,r=p.regexesLabelForWord(s,e,l),a=p.regexModuleForWord(s);r.push(a);let c=p.regexMacroForWord(s);r.push(c);let d=Re.regexStructForWord(s);r.push(d);let u=yield X(r,e.wsFolderPath,t.languageId,e.excludeFiles),m=p.regexLabel(e,l);return yield N(m,u,t.fileName,n,!1,!0,/\w/)})}};var te=y(require("vscode"));var Pe=class{provideHover(e,t,n){return b(this,null,function*(){let o=x.getConfigForDoc(e);if(!(o!=null&&o.enableHovering))return;let s=/\w/,l=e.lineAt(t.line).text,{label:r}=ee(l,t.character,s);if(r.startsWith("."))return new te.Hover("");let a=e.languageId,c=e.getWordRangeAtPosition(t);if(!c)return;let d=e.getText(c),u=p.regexesLabelForWord(d,o,a),m=p.regexModuleForWord(d);u.push(m);let g=p.regexMacroForWord(d);u.push(g);let w=yield X(u,o.wsFolderPath,a,o.excludeFiles),v=p.regexLabel(o,a),L=yield N(v,w,e.fileName,t,!1,!0,s),h=new Array;for(let P of L){let M=P.moduleLabel;if(o.labelsExcludes.includes(M))continue;let D=P.range.start.line,I=P.uri.fsPath,E=(yield te.workspace.openTextDocument(I)).getText().split(`
`),O=dt(E,D);O.length>0&&(h.length>0&&h.push(new te.MarkdownString("============")),h.push(...O.map(H=>new te.MarkdownString(H))))}return h.length==0?void 0:new te.Hover(h)})}};var ie=y(require("vscode"));var ht=require("fs"),B=y(require("vscode"));var z=class{static Init(e){this.context=e}static Get(e){return this.context.globalState.get(e)}static Set(e,t){b(this,null,function*(){yield this.context.globalState.update(e,t)})}};var se=class{static showInfoMessage(e,...t){return b(this,null,function*(){return""})}static openDonateWebView(){}static now(){return Date.now()}static getPreviousVersion(){return""}static getCurrentVersion(){return""}static getDonationTime(){}static setDonationTime(e){}static getDonatedPref(){return!1}static checkVersion(){let e=this.getPreviousVersion();this.getCurrentVersion()!=e&&this.setDonationTime(void 0),this.donatedPreferencesChanged()}static donatedPreferencesChanged(){let e=this.getDonatedPref();this.evaluateDonateTime=e?void 0:this.now()}static checkDonateInfo(){this.enableDonationInfo&&this.evaluateDonateTime!=null&&this.now()>=this.evaluateDonateTime&&(this.evaluateDonateTime=this.now()+this.daysInMs(1),this.donateEndTime==null&&(this.donateEndTime=this.getDonationTime(),this.donateEndTime==null&&(this.donateEndTime=this.now()+this.daysInMs(14),this.setDonationTime(this.donateEndTime))),this.now()<this.donateEndTime?b(this,null,function*(){let e=yield this.showInfoMessage("If you use 'ASM Code Lens' regularly please support the project. Every little donation helps keeping the project running.","Yes, please. I want to show my support","Not now");e!=null&&e.toLowerCase().startsWith("yes")&&this.openDonateWebView()}):this.evaluateDonateTime=void 0)}static daysInMs(e){return e*24*60*60*1e3}};se.enableDonationInfo=!1,se.evaluateDonateTime=void 0,se.donateEndTime=void 0;var kt=require("path"),J=class extends se{static showInfoMessage(e,...t){return b(this,null,function*(){return B.window.showInformationMessage(e,...t)})}static getPreviousVersion(){return z.Get(this.VERSION_ID)}static getCurrentVersion(){return R.extension.packageJSON.version}static getDonationTime(){return z.Get(this.DONATE_TIME_ID)}static setDonationTime(e){z.Set(this.DONATE_TIME_ID,e)}static getDonatedPref(){return!!R.getConfiguration().get("donated")}static openDonateWebView(){let e=B.window.createWebviewPanel("","",{preserveFocus:!0,viewColumn:B.ViewColumn.Nine});e.title="Donate...";let t=R.extension.extensionPath,n=kt.join(t,"html/donate.html"),o=(0,ht.readFileSync)(n).toString(),s=B.Uri.file(t),l=e.webview.asWebviewUri(s).toString();o=o.replace("${vscodeResPath}",l),e.webview.options={enableScripts:!0},e.webview.onDidReceiveMessage(r=>{switch(r.command){case"showExtension":b(this,null,function*(){yield B.commands.executeCommand("workbench.extensions.search",R.extension.packageJSON.publisher)});break}}),e.webview.html=o}};J.VERSION_ID="version",J.DONATE_TIME_ID="donateTimeId";var Xe=class extends ie.CodeLens{constructor(t,n,o,s){super(o);this.config=t,this.document=n,this.symbol=s}},Fe=class{provideCodeLenses(e,t){return b(this,null,function*(){J.checkDonateInfo();let n=x.getConfigForDoc(e);if(!(n!=null&&n.enableCodeLenses))return;let o=e.languageId,s=[],l=p.regexLabel(n,o),r=Ke(e,l);for(let a of r){let c=a.line,d=a.match[1]?a.match[1].length:0,u=a.end,g=e.lineAt(c).text.substring(d,u);g.endsWith(":")&&(u--,g=g.substring(0,g.length-1));let w=g.trim();if(!n.labelsExcludes.includes(w.toLowerCase())){let v=new ie.Position(c,d),L=new ie.Position(c,u),h=new ie.Range(v,L),j=new Xe(n,e,h,w);s.push(j)}}return s})}resolveCodeLens(e,t){return b(this,null,function*(){let n=e.symbol,o=p.regexAnyReferenceForWord(n),s=e.document,l=e.range.start,r=e.config,a=s.languageId,c=yield _(o,r.wsFolderPath,a,r.excludeFiles),d=p.regexLabel(r,a),u=yield N(d,c,s.fileName,l,!0,!0),m=u.length,g=m+" reference";return m!=1&&(g+="s"),e.command={title:g,command:"editor.action.showReferences",arguments:[s.uri,l,u]},e})}};var be=y(require("vscode"));var Se=class{static regexAnyReferenceForWordGlobal(e){return new k(new RegExp("\\b"+e+"\\b"),new RegExp("(.*?)\\b"+e+"\\b","g"))}};var ye=class{provideRenameEdits(e,t,n,o){return b(this,null,function*(){let s=new be.WorkspaceEdit,l=x.getConfigForDoc(e);if(!l)return yield be.window.showWarningMessage("Document is in no workspace folder."),s;if(!l.enableRenaming)return yield be.window.showWarningMessage("Renaming is disabled for this workspace folder."),s;let r=e.getWordRangeAtPosition(t);if(!r)return s;let a=e.getText(r),c=Se.regexAnyReferenceForWordGlobal(a),d=e.languageId,u=yield _(c,l.wsFolderPath,d,l.excludeFiles),m=p.regexLabel(l,d),g=yield N(m,u,e.fileName,t,!1,!0,/\w/);for(let w of g)s.replace(w.uri,w.range,n);return s})}};var T=y(require("vscode"));var oe=class{static regexModuleLabel(){return/\b(module\s+([a-z_][\w.]*)|endmodule.*)/i}static regexStructLabel(){return/\b(struct\s+([a-z_][\w.]*)|ends.*)/i}static regexConst(){return/\b(equ)\s+(.*)/i}static regexData(){return/\b(d[bcdghmsw]|def[bdghmsw])\b\s*(.*)/i}static regexMacro(e){if(e!=="asm-list-file")return/\b(macro)\s+(.*)/i}};var Me=class{provideDocumentSymbols(e,t){let n=x.getConfigForDoc(e);if(!(n!=null&&n.enableOutlineView))return;let o=e.languageId,s=[],l=p.regexLabel(n,o),r=oe.regexModuleLabel(),a=oe.regexStructLabel(),c=["include",...n.labelsExcludes],d=oe.regexConst(),u=oe.regexData(),m=oe.regexMacro(o),g,w=new Array,v,L=new Array,h=e.getText().split(`
`);ne(h);let j=h.length;for(let P=0;P<j;P++){let M=h[P],D=l.exec(M);if(D){let F=D[0].trimEnd(),C=D[1]+D[2];if(!c.includes(C)){let E=new T.Range(P,0,P,Number.MAX_SAFE_INTEGER),O=E;if(g=new T.DocumentSymbol(C,"",T.SymbolKind.Function,E,O),w.push(g),C.startsWith("."))v==null||v.push(g);else if(C.startsWith("@"))s.push(g);else{let Q=L.length;Q>0?L[Q-1].children.push(g):s.push(g),v=g.children}let H=F.length;M=M.substring(H),M+=" "}}if(m){let F=m.exec(M);if(F){let C=F[2];C===""&&(C=" ");let E=new T.Range(P,0,P,Number.MAX_SAFE_INTEGER),O=new T.DocumentSymbol(C,"macro",T.SymbolKind.Interface,E,E);s.push(O);continue}}let I=r.exec(M);if(I||(I=a.exec(M)),I){let F=I[1].toLowerCase(),C=I[2];if(C){let E=new T.Range(P,0,P,Number.MAX_SAFE_INTEGER),O=F.startsWith("module")?T.SymbolKind.Module:T.SymbolKind.Struct,H=new T.DocumentSymbol(C,"",O,E,E),Q=L.length;Q>0?L[Q-1].children.push(H):s.push(H),L.push(H)}(F=="endmodule"||F=="ends")&&(L.pop(),v=void 0),g=void 0,w.length=0;continue}if(M=M.trim(),g&&M){let F,C=d.exec(M);if(C?F=T.SymbolKind.Constant:(C=u.exec(M),C&&(F=T.SymbolKind.Field)),F!=null)for(let E of w)E.kind=F,E.detail=C[1]+" "+C[2].trimEnd();g=void 0,w.length=0;continue}}return s}};var W=y(require("vscode"));var $=class{static regexesEveryLabelForWord(e,t,n){let o=[];if(t.labelsWithColons){let s=this.regexEveryLabelColonForWord(e,n);o.push(s)}if(t.labelsWithoutColons&&n=="asm-collection"){let s=this.regexEveryLabelWithoutColonForWord(e);o.push(s)}return o}static regexEveryLabelWithoutColonForWord(e){return new RegExp("^(([^0-9 ][\\w\\.]*)?)\\b"+e+"[\\w\\.]*\\b(?![:\\w\\.])","i")}static regexEveryLabelColonForWord(e,t){return t==="asm-list-file"?new RegExp("^(.*)\\b"+e+"[\\w\\.]*:","i"):new RegExp("(^@?[\\w\\.]*|^.*\\s@?[\\w\\.]*)\\b"+e+"[\\w\\.]*:","i")}static regexEveryModuleForWord(e,t){return t=="asm-list-file"?new RegExp("^(.*?\\s+(MODULE)\\s+)"+e+"[\\w\\.]*","i"):new RegExp("^(\\s+(MODULE)\\s+)"+e+"[\\w\\.]*","i")}static regexEveryMacroForWord(e,t){return t=="asm-list-file"?new RegExp("^(.*?\\s+(MACRO)\\s+)"+e+"[\\w\\._]*","i"):new RegExp("^(\\s+(MACRO)\\s+)"+e+"[\\w\\._]*","i")}};var Tt=["a","b","c","d","e","h","l","af","bc","de","hl","ix","iy","sp","ixl","ixh","iyl","iyh","adc","add","and","bit","call","ccf","cp","cpd","cpdr","cpi","cpir","cpl","daa","dec","di","ei","djnz","ex","exx","halt","im","inc","in","ind","indr","ini","inir","jp","jr","ld","ldd","lddr","ldi","ldir","neg","nop","or","otdr","otir","out","outd","outi","pop","push","res","ret","reti","retn","rl","rla","rlc","rlca","rld","rr","rra","rrc","rrca","rrd","rst","sbc","scf","set","sla","slia","sll","swap","sra","srl","sub","xor","ldix","ldws","ldirx","lddx","lddrx","ldpirx","outinb","mul","swapnib","mirror","nextreg","pixeldn","pixelad","setae","test","bsla","bsra","bsrl","bsrf","brlc","sli","macro","endm","module","endmodule","struct","ends","dup","edup","if","ifn","ifdef","ifndef","ifused","ifnused","else","endif","include","incbin","abyte","abytec","abytez","align","assert","binary","block","defb","defd","defg","defh","defl","defm","defs","defw","dephase","disp","phase","unphase","d24","db","dc","dd","dg","dh","hex","dm","ds","dw","dz","display","byte","word","dword","emptytap","emptytrd","encoding","equ","export","end","endlua","endt","ent","includelua","inchob","inctrd","insert","lua","labelslist","org","outend","output","memorymap","mmu","page","rept","endr","savebin","savedev","savehob","savesna","savetrd","savetap","basic","code","numbers","chars","headless","savenex","core","cfg","cfg3","bar","palette","default","mem","bmp","screen","l2","l2_320","l2_640","scr","shc","shr","tile","cooper","bank","auto","shellexec","size","slot","tapend","tapout","textarea","define","undefine","defarray","defarray+","device","ZXSPECTRUM48","ZXSPECTRUM128","ZXSPECTRUM256","ZXSPECTRUM512","ZXSPECTRUM1024","ZXSPECTRUM2048","ZXSPECTRUM4096","ZXSPECTRUM8192","ZXSPECTRUMNEXT","NONE","ramtop","open","close","setbp","setbreakpoint","bplist","unreal","zesarux","opt","cspectmap","fpos","_sjasmplus","_version","_release","_errors","_warnings"],Ie=class{provideCompletionItems(e,t,n){return b(this,null,function*(){let o=x.getConfigForDoc(e);if(!(o!=null&&o.enableCompletions))return;let s=o.completionsRequiredLength,l=e.lineAt(t).text,r=ee(l,t.character),a=r.label.length;if(r.label.startsWith(".")&&a--,a<s)return new W.CompletionList([new W.CompletionItem(" ")],!1);let c=e.getText().split(`
`),d=t.line,u=xt(c,d),m=c[d],g=ee(m,t.character),w=g.preString.length,v=w+g.label.length,L=new W.Range(new W.Position(d,w),new W.Position(d,v)),h=e.languageId,j=p.regexLabel(o,h),P;g.label.startsWith(".")&&(P=qe(j,c,d));let M=e.getWordRangeAtPosition(t);if(!M)return;let D=e.getText(M),I=p.regexPrepareFuzzy(D),F=$.regexesEveryLabelForWord(I,o,h),C=$.regexEveryModuleForWord(I,h);F.push(C);let E=$.regexEveryMacroForWord(I,h);F.push(E);let O=yield X(F,o.wsFolderPath,h,o.excludeFiles),H=yield N(j,O,e.fileName,t,!0,!1),Q=new Map;for(let Ge of H){let K=Ge.moduleLabel;if(o.labelsExcludes.includes(K))continue;let A=new W.CompletionItem(K,W.CompletionItemKind.Function);if(A.filterText=K,A.range=L,P){A.filterText=g.label;let q=u.length;q>0&&q++,q+=P.length;let le=K.substring(q);A.insertText=le,A.label=le,A.filterText=le}else if(K.startsWith(u+".")){let q=u.length+1,le=K.substring(q);A.insertText=le,A.label="["+K.substring(0,q)+"] "+le}Q.set(A.label,A)}let he=Array.from(Q.values()),we;if(g.label.lastIndexOf(".")<0){let Ge=g.label[0]===g.label[0].toUpperCase(),K=0;we=Tt.map(A=>{Ge&&(A=A.toUpperCase());let q=new W.CompletionItem(A,W.CompletionItemKind.Function);return q.sortText=K.toString(),K++,q.range=L,q}),we.push(...he)}else we=he;return new W.CompletionList(we,!1)})}};var wt=y(require("path")),Te=y(require("vscode"));var De=class{static regexLabelEquOrMacro(){return new k(/(equ|macro)/i,/^.*[a-z_][\w.]*[:\s]\s*(equ|macro)/i)}};var re=Te.window.createOutputChannel("ASM Code Lens"),ke=class{static findLabelsWithNoReference(e,t){return b(this,null,function*(){let n=p.regexLabel(e,t),o=yield X([n],e.wsFolderPath,t,e.excludeFiles);yield this.findLabels(o,e,t)})}static findLabels(e,t,n){return b(this,null,function*(){let o=wt.basename(t.wsFolderPath),s=n=="asm-list-file"?"list":"asm";re.appendLine("Unreferenced labels for "+s+" files, "+o+":"),re.show(!0);try{let l=e.length,r=0,a=De.regexLabelEquOrMacro(),c=p.regexLabel(t,n);for(let d of e){let u=d.fileMatch;if(a.lastIndex=u.match[1].length,a.exec(u.lineContents)){l--,l==0&&re.appendLine("Done. "+r+" unreferenced label"+(r>1?"s":"")+".");continue}let g=u.match[2],w=g.replace(/\./,"\\."),v=new Te.Position(u.line,u.start),L=u.filePath,h=p.regexAnyReferenceForWord(w),j=yield _(h,t.wsFolderPath,n,t.excludeFiles);if((yield N(c,j,L,v,!0,!0)).length==0&&(r++,re.appendLine(g+", "+L+":"+(v.line+1))),l--,l==0){let D=r+" unreferenced label";re.appendLine("Done. "+D+(r>1?"s":"")+".")}}}catch(l){console.log("Error: ",l)}e.length==0&&re.appendLine("None."),re.appendLine("")})}};var vt=y(require("vscode")),Lt=y(require("path")),Et=require("fs");var xe=class{resolveWebviewView(e,t,n){this.webview=e.webview,this.webview.options={enableScripts:!0},this.webview.onDidReceiveMessage(o=>{switch(o.command){case"donateClicked":J.openDonateWebView();break}}),this.setMainHtml()}setMainHtml(){if(!this.webview)return;let e=R.extension.extensionPath,t=Lt.join(e,"html","hexcalc.html"),n=(0,Et.readFileSync)(t).toString(),o=vt.Uri.file(e),s=this.webview.asWebviewUri(o).toString();n=n.replace(/\${vscodeResPath}/g,s);let l=R.getConfiguration(),r=l.get("hexCalculator.hexPrefix");n=n.replace("//${init}",`
let hexPrefix = "${r}";`),l.get("donated")||(n=n.replace("<!--${donate}-->",`
		<button class="button-donate" style="float:right" onclick="donateClicked()">Donate...<div style="float:right;font-size:50%">ASM Code Lens</div></button>`)),this.webview.html=n}};var ue=y(require("vscode")),$e=y(require("path")),Ze=require("fs");var We=class{static isNewVersion(e,t){try{if(!e)return!1;let n=e.split(".");if(n.length<2)return!1;if(!t)return!0;let o=t.split(".");if(o.length<2)return!0;let s=parseInt(n[0]);if(isNaN(s))return!1;let l=parseInt(n[1]);if(isNaN(l))return!1;let r=parseInt(o[0]);if(isNaN(r))return!0;let a=parseInt(o[1]);return!!(isNaN(a)||s>r||l>a)}catch(n){return!1}}};var de=class{static updateVersion(){let e="version",t=z.Get(e),n=R.extension.packageJSON.version;return n!=t&&z.Set(e,n),We.isNewVersion(n,t)}constructor(){this.vscodePanel=ue.window.createWebviewPanel("","",{preserveFocus:!0,viewColumn:ue.ViewColumn.Nine}),this.vscodePanel.title="Whats New",this.setHtml()}setHtml(){if(!this.vscodePanel.webview)return;let e=R.extension.extensionPath,t=$e.join(e,"html/whatsnew.html"),n=(0,Ze.readFileSync)(t).toString(),o=ue.Uri.file(e),s=this.vscodePanel.webview.asWebviewUri(o).toString();n=n.replace("${vscodeResPath}",s),n=n.replace(/\${extensionName}/g,R.extension.packageJSON.id);let l=R.extension.packageJSON.version.split("."),r=l.shift()||"",a=l.shift();a&&(r+="."+a),n=n.replace(/\${extensionMainVersion}/g,r),n=n.replace(/\${extensionDisplayName}/g,R.extension.packageJSON.displayName),n=n.replace(/\${repositoryUrl}/g,R.extension.packageJSON.repository.url),n=n.replace(/\${repositoryIssues}/g,R.extension.packageJSON.bugs.url),n=n.replace(/\${repositoryHomepage}/g,R.extension.packageJSON.repository.url);let c=$e.join(e,"html/whatsnew_changelog.html"),d=(0,Ze.readFileSync)(c).toString();n=n.replace("${changeLog}",d),this.vscodePanel.webview.html=n}};var ge=y(require("vscode"));var Ae=class{provideWorkspaceSymbols(e,t){return new Promise(n=>{b(this,null,function*(){let o=[],s=ge.workspace.workspaceFolders;if(s){let l=e.length;for(let r of s){if(t.isCancellationRequested){n(void 0);return}let a=x.configs.get(r.uri.fsPath);if(!(a!=null&&a.enableWorkspaceSymbols))continue;let c=a.workspaceSymbolsRequiredLength;if(l<c)continue;let d=yield this.getWsSymbols(a,e);o.push(...d)}}n(o)})})}getWsSymbols(e,t){return b(this,null,function*(){let n="asm-collection",o=p.regexPrepareFuzzy(t),s=$.regexesEveryLabelForWord(o,e,n),l=$.regexEveryModuleForWord(o,n);s.push(l);let r=$.regexEveryMacroForWord(o,n);s.push(r);let a=yield X(s,e.wsFolderPath,n,e.excludeFiles),c=[];for(let d of a){let u=d.symbol;if(e.labelsExcludes.includes(u))continue;let m=new ge.Location(d.uri,d.range),g=new ge.SymbolInformation(u,void 0,"",m);c.push(g)}return c})}};var Z=y(require("vscode"));var U=class{static regexCommentSingleLine(e){let t=new Set([";","//"]);e&&t.add(e);let o="^("+Array.from(t).join("|")+")";return new RegExp(o)}static regexCommentMultipleStart(){return/^\/\*/}static regexCommentMultipleEnd(){return/\*\//}static regexModuleStart(){return/\s+module\b/i}static regexModuleEnd(){return/\s+endmodule\b/i}static regexStructStart(){return/\s+struct\b/i}static regexStructEnd(){return/\s+ends\b/i}static regexMacroStart(){return/\s+macro\b/i}static regexMacroEnd(){return/\s+endm\b/i}};var Ne=class{provideFoldingRanges(e,t,n){let o=x.getConfigForDoc(e);if(!(o!=null&&o.enableFolding))return[];let l=e.getText().split(`
`),r=[],a=p.regexLabel(o,"asm-collection"),c=U.regexCommentMultipleStart(),d=U.regexCommentMultipleEnd(),u=U.regexCommentSingleLine(x.globalToggleCommentPrefix),m=-1,g,w=l.length;for(let v=0;v<w;v++){let L=l[v];switch(g){case"/*":d.exec(L)&&(this.addRange(r,m,v,Z.FoldingRangeKind.Comment),g=void 0);break;case";":u.exec(L)||(v--,this.addRange(r,m,v,Z.FoldingRangeKind.Comment),g=void 0);break;case"label":default:{let h;a.exec(L)?h="label":u.exec(L)?h=";":c.exec(L)&&(h="/*"),h&&(g==="label"&&this.addRange(r,m,v-1,Z.FoldingRangeKind.Region),m=v,g=h);break}}}if(g){let v=g==="label"?Z.FoldingRangeKind.Region:Z.FoldingRangeKind.Comment;this.addRange(r,m,w-1,v)}return ne(l),this.addRangesForRegex(l,r,U.regexModuleStart(),U.regexModuleEnd()),this.addRangesForRegex(l,r,U.regexStructStart(),U.regexStructEnd()),this.addRangesForRegex(l,r,U.regexMacroStart(),U.regexMacroEnd()),r}addRange(e,t,n,o){if(n>t){let s=new Z.FoldingRange(t,n,o);e.push(s)}}addRangesForRegex(e,t,n,o){let s=[],l=-1,r=e.length-1;for(let a of e)if(l++,n.exec(a)){let c=new Z.FoldingRange(l,r,Z.FoldingRangeKind.Region);s.push(c),t.push(c)}else if(o.exec(a)){let c=s.pop();c&&(c.end=l)}}};function Wt(i){R.Init(i),z.Init(i),J.checkVersion(),de.updateVersion()&&new de,i.subscriptions.push(S.commands.registerCommand("asm-code-lens.whatsNew",()=>new de)),Oe=new xe,i.subscriptions.push(S.window.registerWebviewViewProvider("asm-code-lens.calcview-explorer",Oe,{webviewOptions:{retainContextWhenHidden:!0}})),Ve=new xe,i.subscriptions.push(S.window.registerWebviewViewProvider("asm-code-lens.calcview-debug",Ve,{webviewOptions:{retainContextWhenHidden:!0}})),_e(i),i.subscriptions.push(S.workspace.onDidChangeConfiguration(t=>{_e(i,t)})),i.subscriptions.push(S.workspace.onDidChangeWorkspaceFolders(t=>{_e(i)})),S.commands.registerCommand("asm-code-lens.find-labels-with-no-reference",()=>b(this,null,function*(){let t=S.window.activeTextEditor,n=t==null?void 0:t.document;if(!n)return;let o=n.languageId;if(o!="asm-collection"&&o!="asm-list-file")return;let s=x.getConfigForDoc(n);s&&(yield ke.findLabelsWithNoReference(s,o))}))}function _e(i,e){e&&(e.affectsConfiguration("asm-code-lens.hexCalculator.hexPrefix")||e.affectsConfiguration("asm-code-lens.donated"))&&(Oe&&Oe.setMainHtml(),Ve&&Ve.setMainHtml(),J.donatedPreferencesChanged()),Y(Be,i),Y(Ye,i),Y(Qe,i),Y(et,i),Y(tt,i),Y(ot,i),Y(nt,i),Y(st,i),Y(it,i),x.init();let t=[{scheme:"file",language:"asm-collection"},{scheme:"file",language:"asm-list-file"}];if(x.globalEnableCodeLenses){let o=new Fe;Be=S.languages.registerCodeLensProvider(t,o),i.subscriptions.push(Be)}x.globalEnableHovering&&(Ye=S.languages.registerHoverProvider(t,new Pe),i.subscriptions.push(Ye)),x.globalEnableCompletions&&(Qe=S.languages.registerCompletionItemProvider(t,new Ie),i.subscriptions.push(Qe)),x.globalEnableGotoDefinition&&(et=S.languages.registerDefinitionProvider(t,new Ce),i.subscriptions.push(et)),x.globalEnableFindAllReferences&&(tt=S.languages.registerReferenceProvider(t,new Ee),i.subscriptions.push(tt)),x.globalEnableRenaming&&(ot=S.languages.registerRenameProvider(t,new ye),i.subscriptions.push(ot)),x.globalEnableOutlineView&&(nt=S.languages.registerDocumentSymbolProvider(t,new Me),i.subscriptions.push(nt)),x.globalEnableWorkspaceSymbols&&(st=S.languages.registerWorkspaceSymbolProvider(new Ae),i.subscriptions.push(st)),it=S.languages.registerFoldingRangeProvider({scheme:"file",language:"asm-collection"},new Ne),i.subscriptions.push(it),S.languages.setLanguageConfiguration("asm-collection",{comments:{lineComment:x.globalToggleCommentPrefix,blockComment:["/*","*/"]}}),ct(x.globalToggleCommentPrefix);let n=[["{","}"],["[","]"],["(",")"]];x.globalEnablePushPopMatching&&n.push(["push","pop"]),S.languages.setLanguageConfiguration("asm-collection",{brackets:n})}function Y(i,e){if(i){i.dispose();let t=e.subscriptions.indexOf(i);e.subscriptions.splice(t,1)}}var Oe,Ve,Be,Ye,Qe,et,tt,ot,nt,st,it;0&&(module.exports={activate});
